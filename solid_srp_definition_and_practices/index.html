<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.0.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=1">

<meta name="google-site-verification" content="5JWyXG4mx6i5avE6xJfXIRHu_YCofrhDQRCEgbm_5ak" />
<title>物件導向設計原則：單一職責原則，定義、解析與實踐 - WadeHuang1993&#39;s Blog</title>


    <meta name="description" content="單一職責原則(Single responsibility principle) 定義：  A class should have only one reason to change.以一個類別來說，應該只有一個引起它變化的原因。  ”等等，這是在說人話嗎？還是我理解能力不夠好？“ 這是我第一次讀到 SRP 原則定義的反應，當時覺得 SOLID 每個原則都是文字天書。若你也有跟我一樣的反應，不要緊張">
<meta name="keywords" content="Clean Code,SOLID 原則">
<meta property="og:type" content="article">
<meta property="og:title" content="物件導向設計原則：單一職責原則，定義、解析與實踐">
<meta property="og:url" content="https:&#x2F;&#x2F;wadehuang1993.github.io&#x2F;blog&#x2F;solid_srp_definition_and_practices&#x2F;index.html">
<meta property="og:site_name" content="WadeHuang1993&#39;s Blog">
<meta property="og:description" content="單一職責原則(Single responsibility principle) 定義：  A class should have only one reason to change.以一個類別來說，應該只有一個引起它變化的原因。  ”等等，這是在說人話嗎？還是我理解能力不夠好？“ 這是我第一次讀到 SRP 原則定義的反應，當時覺得 SOLID 每個原則都是文字天書。若你也有跟我一樣的反應，不要緊張">
<meta property="og:locale" content="zh-TW">
<meta property="og:image" content="https:&#x2F;&#x2F;wadehuang1993.github.io&#x2F;blog&#x2F;blog&#x2F;images&#x2F;thumbnail&#x2F;CLEAN_CODE.jpg">
<meta property="og:updated_time" content="2020-01-02T08:06:10.429Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;wadehuang1993.github.io&#x2F;blog&#x2F;blog&#x2F;images&#x2F;thumbnail&#x2F;CLEAN_CODE.jpg">







<link rel="icon" href="/blog/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/vs2015.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/blog/css/back-to-top.css">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154595924-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-154595924-1');
</script>

    
    
    
    
    
    
    
    
    


<link rel="stylesheet" href="/blog/css/style.css">

</head>
<!-- <body class="is-2-column"> -->
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/blog/">
            
                <img src="/blog/images/mylogo.png" alt="物件導向設計原則：單一職責原則，定義、解析與實踐" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/blog/">首頁</a>
                
                <a class="navbar-item"
                href="/blog/archives">文章時間軸</a>
                
                <a class="navbar-item"
                href="/blog/categories">分類檢索</a>
                
                <a class="navbar-item"
                href="/blog/tags">標籤</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="文章目錄" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="搜尋" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main">
<div class="card">
    
    <div class="card-image">
        <span  class="image is-7by1">
            <img class="thumbnail" src="/blog/images/thumbnail/CLEAN_CODE.jpg" alt="物件導向設計原則：單一職責原則，定義、解析與實踐">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-12-03T03:04:00.000Z">2019-12-03</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/blog/categories/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E6%80%9D%E7%B6%AD/">程式設計思維</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    39 分鐘 閱讀文 (大約 5778 個字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                物件導向設計原則：單一職責原則，定義、解析與實踐
            
        </h1>
        <div class="content">
            <p>單一職責原則(Single responsibility principle)</p>
<h1 id="定義："><a href="#定義：" class="headerlink" title="定義："></a>定義：</h1><hr>
<blockquote>
<p>A class should have only one reason to change.<br>以一個類別來說，應該只有一個引起它變化的原因。</p>
</blockquote>
<p>”等等，這是在說人話嗎？還是我理解能力不夠好？“</p>
<p>這是我第一次讀到 SRP 原則定義的反應，當時覺得 SOLID 每個原則都是文字天書。若你也有跟我一樣的反應，不要緊張，大家都經歷過這個過程。我將會在本文中以自己的體悟來講解觀念，實務經驗演示如何實踐 SOLID 原則。</p>
<p>單一職責原則是 SOLID 原則中看起來最容易明白，卻也是最容易讓人混淆的原則。因為很多人並不清楚 <strong>職責</strong> 是什麼，甚至誤以為一個類別只能做一件事。接下來的文章中會依序講解原則的目的；解決什麼問題；如何實踐。</p>
<a id="more"></a>

<h2 id="目的："><a href="#目的：" class="headerlink" title="目的："></a>目的：</h2><blockquote>
<p><strong>提高程式碼的內聚性，讓程式碼更易於管理和重複使用。</strong></p>
</blockquote>
<h2 id="解析："><a href="#解析：" class="headerlink" title="解析："></a>解析：</h2><h3 id="什麼是內聚？"><a href="#什麼是內聚？" class="headerlink" title="什麼是內聚？"></a>什麼是內聚？</h3><p>在英文辭典中 <code>內聚(Cohesion)</code> 的同義詞為一致性、凝聚、結合等等，描述相關的事務如何聯繫在一起。在軟體開發中，<strong>高質量程式碼通常是高內聚性的</strong>，<code>內聚</code> 程式碼的特徵為：</p>
<blockquote>
<p><strong>每個程式碼片段都只關注一件事情</strong></p>
</blockquote>
<p>當每段程式碼只關注一件事情時，程式碼會更容易被理解和處理，且相較 <strong>低內聚</strong> 的程式碼來說更容易編寫。</p>
<h3 id="什麼情況會造成低內聚"><a href="#什麼情況會造成低內聚" class="headerlink" title="什麼情況會造成低內聚?"></a>什麼情況會造成低內聚?</h3><p><strong>當程式碼包含一個以上「互不相關」的邏輯或意圖時，程式碼的內聚性就會降低。</strong><br>(一般而言，低內聚的程式碼代表高耦合<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>)</p>
<p><strong>程式碼的內聚性一但降低，閱讀與維護程式碼的難度就會提升</strong>。當你必須從一個大函式裡面修改其中一小段邏輯，若不先花時間讀懂函式中每段程式碼之間的關係就直接修改程式碼，很容易破壞函式原先可正常運作的程式碼。為了避免對程式碼造成破壞，開發人員開發過程總是變成：<strong>花費 80% 時間閱讀程式碼，真正編寫程式碼的時間卻只有 20%</strong>。對於維護一個系統來說，這種情況除了相當浪費成本以外，也相當折磨開發人員的心情，更糟的是，每次回來維護又要重新讀一次程式碼。</p>
<h2 id="單一職責原則對專案的重要性？"><a href="#單一職責原則對專案的重要性？" class="headerlink" title="單一職責原則對專案的重要性？"></a>單一職責原則對專案的重要性？</h2><p>單一職責原則乍看之下好像很簡單，但實踐過程其實困難重重。現實狀況常常是：專案起初幾個版本的程式碼意圖都相當簡單明瞭，但是當需求隨著時間增長再加上開發時程短促，讓開發人員不斷在原本的程式碼上堆疊新的程式碼。最後 <strong>舊程式碼與新程式碼糾纏在一起，使得程式碼的意圖和邊界漸漸變得模糊且互相耦合</strong>。若在意圖模糊的程式碼上繼續擴充或修改，則會使程式碼的意圖逐漸流失並且擴大影響範圍，最後變成 <strong>技術債</strong> 折磨維護專案的人員。</p>
<blockquote>
<p>因此，單一職責原則指導開發人員在建立新功能時，不應該把意圖不同的程式碼擺放在一起。</p>
</blockquote>
<p>讓每段程式碼的意圖保持清晰，確保程式碼的意圖不會隨著需求或時間增長而流逝。</p>
<h3 id="為什麼意圖如此重要呢？"><a href="#為什麼意圖如此重要呢？" class="headerlink" title="為什麼意圖如此重要呢？"></a>為什麼意圖如此重要呢？</h3><p>維護專案最怕的就是修改程式碼時 <strong>不知道當初的開發者為什麼要這樣設計程式</strong>。要是冒然修改程式碼，就容易使功能發生錯誤。<strong>這種不確定的感覺會變成開發人員心中的恐懼</strong>，對無知的恐懼常在開發人員的心中作祟：「如果程式碼能好好運作，就別碰了吧！」這也是為什麼專案中經常會存在一段醜陋的程式碼，卻沒人去整理的原因。<strong>意圖模糊的程式碼一但被留下來就會成為專案長久的痛處</strong>，只要新需求和這些程式碼相關，開發時程就會變得緩慢且難以估計。</p>
<p><img src="/blog/images/pasted-1.png" alt="圖一：一個函式包含多個意圖，並且難以辨認每段程式碼之間的意圖與界線。"></p>
<p>若程式碼的意圖有被保留下來，這些程式碼就有機會被改善。<strong>保持程式碼意圖的方法就是盡量隔離意圖不同的程式碼</strong>，避免意圖不相同的程式碼耦合在一起，造成程式碼的意圖與界線都變得模糊。</p>
<h2 id="隔離意圖也是解除耦合"><a href="#隔離意圖也是解除耦合" class="headerlink" title="隔離意圖也是解除耦合"></a>隔離意圖也是解除耦合</h2><p>單一職責原則並不只有保持程式碼意圖這項優點而已，因為隔離意圖的過程中，也會解除不經意耦合的程式碼。<br>開發的過程中常常 <strong>為了共用某些變數或邏輯，將意圖不相同的程式碼安排在一起；或單純只是因為處理的資料相同而被擺放在一起。</strong>雖然程式碼可以運作，卻也造成不同意圖的程式碼互相耦合。耦合的程式碼對維護專案來說是相當致命的。</p>
<blockquote>
<p><strong>意圖不相同的程式碼，通常也意味著修改的時機與頻率不相同</strong>。</p>
</blockquote>
<p>新舊程式碼因為共用變數或邏輯而被安排在一起，常常會因為需求異動，只需要調整 <strong>其中一小段程式碼</strong>。但是開發人員卻需要花費很多時間閱讀與 <strong>當前需求</strong> 不相關的程式碼，只怕程式碼的異動會造成其他程式碼無法正常運行。</p>
<p>以<strong>（圖ㄧ）</strong>為例，不同意圖的程式碼共用一個 Foreach 迴圈，讓開發人員很難判斷修改任一變數後，會不會造成其他程式碼發生錯誤；如果將每個意圖隔離開來，每段程式碼只需要維護自己的小迴圈，即可減少開發人員閱讀程式碼的時間與發生錯誤的機率。</p>
<h1 id="實踐"><a href="#實踐" class="headerlink" title="實踐"></a>實踐</h1><p>接下來的章節將進入實作練習「如何導入單一職責原則」的階段。練習過程中，會先建立一個功能，並且隨著新需求不斷加入新的程式碼。最後再藉由單一職責原則，隔離不同意圖的程式碼，使每段程式碼的意圖得以保持清晰、且不互相耦合。</p>
<h2 id="如何隔離意圖？"><a href="#如何隔離意圖？" class="headerlink" title="如何隔離意圖？"></a>如何隔離意圖？</h2><h3 id="隔離意圖前，須先學會找出可能發生「意圖糾纏」的地方"><a href="#隔離意圖前，須先學會找出可能發生「意圖糾纏」的地方" class="headerlink" title="隔離意圖前，須先學會找出可能發生「意圖糾纏」的地方"></a>隔離意圖前，須先學會找出可能發生「意圖糾纏」的地方</h3><p>導入單一職責原則的過程中，較困難的部分是如何發現意圖不同的程式碼。可能有多個需求都是在處理同一種資料，開發人員也習慣性地將處理相同資料的程式碼擺放在一起。如此一來，不同意圖的程式碼就容易堆疊在一起。因此，除了把處理相同資料的程式碼擺放在一起外，還必須做到隔離不同意圖的程式碼。</p>
<p>接下來以一個簡單的範例來「意圖糾纏」的程式碼是如何產生的：</p>
<h3 id="範例：學生列表"><a href="#範例：學生列表" class="headerlink" title="範例：學生列表"></a>範例：學生列表</h3><p>某系統最原始的版本中，有一個「學生列表」的功能，其需求為：顯示某班級的所有學生。</p>
<p><img src="/blog/images/pasted-3.png" alt="某班級的學生列表"></p>
<p>其程式碼分為 <code>StudentController</code> 與 <code>StudentModel</code> 兩部份。<br>Controller 負責接收 HTTP 參數，並返回學生資料。Model 負責從資料庫撈取學生資料。</p>
<figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">/** var StudentModel **/</span></span><br><span class="line">    <span class="hljs-keyword">private</span> $model;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">studentList</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        $classId = <span class="hljs-keyword">$this</span>-&gt;input-&gt;get(<span class="hljs-string">'classId'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;model-&gt;studentList($classId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> $db;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">studentList</span><span class="hljs-params">($classId)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;select(<span class="hljs-string">'*'</span>);</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;from(<span class="hljs-string">'students'</span>);</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;where(<span class="hljs-string">'students.classId'</span>, $classId);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;db-&gt;get()-&gt;resultArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="新需求：已完成作業的學生列表"><a href="#新需求：已完成作業的學生列表" class="headerlink" title="新需求：已完成作業的學生列表"></a>新需求：已完成作業的學生列表</h4><p>隨著新需求新增，老師想要有一個「已完成作業的學生列表」的畫面。<br>因此開發人員在 Controller 新增一個 <code>studentListByHomeworkStatus()</code> 函式，並且調整 StudentModel 的 <code>studentList()</code> 函式以便撈取對應的查詢條件：</p>
<figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">/** var StudentModel **/</span></span><br><span class="line">    <span class="hljs-keyword">private</span> $model;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/** 顯示某班級的所有學生 **/</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">studentList</span><span class="hljs-params">($classId)</span> </span>&#123;<span class="hljs-comment">/** ...省略 */</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/** 已完成作業的學生列表 **/</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">studentListByHomeworkStatus</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        $classId = <span class="hljs-keyword">$this</span>-&gt;input-&gt;get(<span class="hljs-string">'classId'</span>);</span><br><span class="line">        $homeworkId = <span class="hljs-keyword">$this</span>-&gt;input-&gt;get(<span class="hljs-string">'homeworkId'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;model-&gt;studentList($classId, $homeworkId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> $db;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">studentList</span><span class="hljs-params">($classId, $homeworkId = null)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;select(<span class="hljs-string">'*'</span>);</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;join(<span class="hljs-string">'homeworks'</span>, <span class="hljs-string">'students.id = homeworks.studentId'</span>);</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;from(<span class="hljs-string">'students'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> ($homeworkId != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">            <span class="hljs-keyword">$this</span>-&gt;where(<span class="hljs-string">'homework.id'</span>, $homeworkId);</span><br><span class="line">            <span class="hljs-keyword">$this</span>-&gt;where(<span class="hljs-string">'homeworks.status'</span>, <span class="hljs-string">'done'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;where(<span class="hljs-string">'students.classId'</span>, $classId);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;db-&gt;get()-&gt;resultArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="臨時需求：尚未繳交-108-學年度腳踏車證費用的學生列表"><a href="#臨時需求：尚未繳交-108-學年度腳踏車證費用的學生列表" class="headerlink" title="臨時需求：尚未繳交 108 學年度腳踏車證費用的學生列表"></a>臨時需求：尚未繳交 108 學年度腳踏車證費用的學生列表</h4><p>突然有臨時的需求，校務人員需要匯出「尚未繳交 108 學年度腳踏車證費用的學生列表」，於是開發人員又做了以下變動：</p>
<figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">/** var StudentModel **/</span></span><br><span class="line">    <span class="hljs-keyword">private</span> $model;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/** 顯示某班級的所有學生 **/</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">studentList</span><span class="hljs-params">($classId)</span> </span>&#123;<span class="hljs-comment">/** ...省略 */</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/** 已完成作業的學生列表 **/</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">studentListByHomeworkStatus</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-comment">/** ...省略 */</span>&#125;</span><br><span class="line">   </span><br><span class="line">    <span class="hljs-comment">/** 尚未繳交 108 學年度腳踏車證費用的學生列表 **/</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">studentListThatNotPaidBicyclePassFee</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        $classId = <span class="hljs-keyword">$this</span>-&gt;input-&gt;get(<span class="hljs-string">'classId'</span>);</span><br><span class="line">        $bicyclePassYear = <span class="hljs-number">108</span>;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;model-&gt;studentList($classId, <span class="hljs-keyword">null</span>, $bicyclePassYear);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> $db;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">studentList</span><span class="hljs-params">($classId, $homeworkId = null, $bicyclePassYear = null)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;select(<span class="hljs-string">'*'</span>);</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;join(<span class="hljs-string">'homeworks'</span>, <span class="hljs-string">'students.id = homeworks.studentId'</span>);</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;leftJoin(<span class="hljs-string">'bicyclePass'</span>, <span class="hljs-string">'students.id = bicyclePass.studentId'</span>);</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;from(<span class="hljs-string">'students'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> ($homeworkId != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">            <span class="hljs-keyword">$this</span>-&gt;where(<span class="hljs-string">'homework.id'</span>, $homeworkId);</span><br><span class="line">            <span class="hljs-keyword">$this</span>-&gt;where(<span class="hljs-string">'homeworks.status'</span>, <span class="hljs-string">'done'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="hljs-keyword">if</span> ($bicyclePassYear != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">            <span class="hljs-keyword">$this</span>-&gt;db-&gt;where(<span class="hljs-string">'bicyclePass.year'</span>, $bicyclePassYear);</span><br><span class="line">            <span class="hljs-keyword">$this</span>-&gt;db-&gt;where(<span class="hljs-string">'bicyclePass.payStatus'</span>, <span class="hljs-keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;where(<span class="hljs-string">'students.classId'</span>, $classId);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;db-&gt;get()-&gt;resultArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="新需求只會不斷地出現"><a href="#新需求只會不斷地出現" class="headerlink" title="新需求只會不斷地出現"></a>新需求只會不斷地出現</h4><p>隨著時間的推移，功能也會不斷出現新需求，需求幾乎是無限上綱的。例如：以性別撈取學生、以戶籍地址撈取學生、撈取沒繳午餐費的學生、撈取午餐吃素的學生、已經繳交學雜費撈取學生 …等。</p>
<p>當這些需求都被寫在同一個功能裡面時，就能發現 <code>studentList()</code> 函式中充滿意圖不同的程式碼：</p>
<p><img src="/blog/images/pasted-2.png" alt="圖二：studentList 函式中充滿意圖不同的程式碼"></p>
<p>從<strong>（圖二）</strong>可看到 <code>studentList()</code> 總共包含了 8 個意圖的程式碼，其中 <code>6.撈取沒繳午餐費的學生</code> 和 <code>7.撈取午餐吃素的學生</code> 還共用同一段 Join 邏輯，產生了不經意的耦合。</p>
<p>這樣的程式碼會有下列問題：</p>
<ol>
<li><strong>不易閱讀與維護</strong>：為了避免改壞其他意圖的程式碼，每次進來改程式碼都要先讀過所有與 <strong>當前需求</strong> 不相關的程式碼。</li>
<li><strong>額外的工作</strong>：不同意圖的程式碼被耦合在一起，造成部分意圖被迫執行不同意圖的程式碼。除了讓功能變得不穩定以外，日積月累還有可能成為系統的效能瓶頸。<ul>
<li><code>studentList()</code> 範例中，部分意圖被迫執行其他意圖的 <code>Join</code> 邏輯。   </li>
</ul>
</li>
<li><strong>修改不能局部化</strong>：每個意圖共用同一個函式，當某個意圖不小心寫入嚴重錯誤 Bug，會連同其他意圖的功能也跟著發生錯誤。</li>
<li><strong>不同的變動率</strong>：每個意圖會以不同的時機與頻率修改程式碼，讓原本正常運作的功能變得不穩定，隨時會被改成壞掉的。</li>
</ol>
<p>學生列表的範例相當簡單，看起來影響不大，很容易解決。但實際上 <strong>意圖交纏</strong> 的問題常常出現在系統各處，而且每個問題的耦合程度與複雜度都不相同。通常等你意識到程式碼很難修改時，耦合的問題也已經很嚴重了。</p>
<p>因此，每個開發人員都應該學會如何隔離意圖。</p>
<h2 id="隔離意圖：功能插件化-的思維"><a href="#隔離意圖：功能插件化-的思維" class="headerlink" title="隔離意圖：功能插件化 的思維"></a>隔離意圖：功能插件化 的思維</h2><p>解決意圖耦合最快的方式就是將 <strong>功能插件化</strong>，藉由 <code>增加新的程式碼</code> 來擴充系統的功能，而 <code>不是藉由修改原本已經存在的程式碼</code> 來擴充系統的功能，其原理為：</p>
<blockquote>
<p>將「核心的邏輯」與「附加功能的邏輯」隔離開來，讓附加功能擴充核心功能的邏輯。</p>
</blockquote>
<p>實務上可以從觀察程式碼中發現，<strong>會隨著需求增長的程式碼，通常是附加功能的邏輯</strong>；<strong>不會隨著需求被改變的程式碼，通常是核心邏輯</strong>。</p>
<p>這種開發思維對不熟悉物件導向的人來說應該覺得很奇怪，但是將 <strong>功能插件化</strong> 早在軟體開發領域隨處可見，應用層面從程式開發、框架、系統層級都有：</p>
<ul>
<li>JavaScript 透過註冊 event 事件，擴充瀏覽器行為。</li>
<li>MVC 框架透過繼承 Controller 或 Model 擴充框架的行為，以便完成功能。</li>
<li>瀏覽器透過安裝擴充套件，擴充瀏覽器行為。</li>
<li>手機透過安裝 APP，擴充手機行為。</li>
</ul>
<p>以「學生列表」功能為例，<strong>核心的邏輯為</strong>：撈取學生列表；<strong>附加功能的邏輯為</strong>：其他完成新需求的程式碼。</p>
<p>接下來將 <strong>導入介面(Interface)</strong> 讓「學生列表」功能插件化，隔離意圖不同的程式碼。</p>
<p>Note: </p>
<blockquote>
<p>因本篇文章探討的是物件導向設計原則，故以介面（Interface）來實踐功能插件化，但並不表示功能插件化只可以透過介面或物件導向的方式實踐。</p>
</blockquote>
<h2 id="導入介面（Interface）"><a href="#導入介面（Interface）" class="headerlink" title="導入介面（Interface）"></a>導入介面（Interface）</h2><p>實踐 <strong>功能插件化</strong>一共有 4 步驟：</p>
<ol>
<li>找出核心邏輯</li>
<li>開放擴充點，供核心邏輯隨時可以使用插件。</li>
<li>當有需求時，按照擴充點的定義，實作新的插件以便完成需求。</li>
<li>將新的插件注入核心邏輯中。</li>
</ol>
<h3 id="1-找出核心邏輯，並開放擴充介面"><a href="#1-找出核心邏輯，並開放擴充介面" class="headerlink" title="1. 找出核心邏輯，並開放擴充介面"></a>1. 找出核心邏輯，並開放擴充介面</h3><p>各種「學生列表」功能中，最常被執行的功能為 <code>StudentModel-&gt;studentList()</code>，因此我們可以斷定核心邏輯應該在這個函式裡面，並做了些調整：</p>
<figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// ConditionPlugin：擴充 DB 查詢條件的介面</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ConditionPlugin</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setWhereCondition</span><span class="hljs-params">($db)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> $db;</span><br><span class="line">    <span class="hljs-comment">/** <span class="hljs-doctag">@var</span> ConditionPlugin */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> $plugin = <span class="hljs-keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/** 開放從外面注入擴充邏輯 */</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setConditionPlugin</span><span class="hljs-params">(ConditionPlugin $plugin)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;plugin = $plugin;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">studentList</span><span class="hljs-params">($classId)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;select(<span class="hljs-string">'*'</span>);</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;from(<span class="hljs-string">'students'</span>);</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;db-&gt;where(<span class="hljs-string">'students.classId'</span>, $classId);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">// 執行擴充邏輯</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;plugin) &#123;</span><br><span class="line">            <span class="hljs-keyword">$this</span>-&gt;plugin-&gt;setWhereCondition(<span class="hljs-keyword">$this</span>-&gt;db);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;db-&gt;get()-&gt;resultArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>這個步驟中，首先要找出核心邏輯。您可以發現 <code>studentList()</code> 只被保留了最核心的邏輯，也就是隨著需求與時間不變的邏輯。其他的邏輯暫時被忽略了，它們都是附加功能的邏輯，等等會再提及。</p>
<p>找出最核心的邏輯後，下個步驟是開放擴充點。範例中我做了四件事，讓 <code>studentList()</code> 開放了擴充點：</p>
<ul>
<li>新增一個 <code>ConditionPlugin</code> 介面，這個介面接收一個 $db 參數，用來動態調用 $db 物件</li>
<li><strong>StudentModel</strong> 新增私有屬性：<code>$plugin</code></li>
<li><strong>StudentModel</strong> 新增公開方法：<code>setConditionPlugin()</code>，其參數型別為 <code>ConditionPlugin</code> 介面。供外部可以注入插件。</li>
<li><strong>StudentModel-&gt;studentList()</strong> 方法中，調用外部注入插件（<code>$this-&gt;plugin</code>）的<code>setWhereCondition()</code> 方法來擴充核心邏輯的行為。</li>
</ul>
<p>其中，<code>ConditionPlugin</code> 是插件需要實作的介面，實作的內容即為：<strong>擴充核心邏輯，以便完成需求</strong>。只要類別有實作 <code>ConditionPlugin</code> 介面，都可以透過 <code>setConditionPlugin</code> 函式將插件注入到 <strong>StudentModel</strong> 中。這樣的作法是利用物件導向 <strong>多型</strong> 的特性，讓程式碼可以隨著 <code>$plugin</code> 變數運作時的真實物件，會引發不同的動作，達到擴充核心邏輯的效果。</p>
<p>接下來我們將依照 <code>ConditionPlugin</code> 介面的定義，實作各種「學生列表」功能的插件：</p>
<h3 id="2-實作插件介面，並於注入插件"><a href="#2-實作插件介面，並於注入插件" class="headerlink" title="2. 實作插件介面，並於注入插件"></a>2. 實作插件介面，並於注入插件</h3><p>為了縮短範例的長度，此步驟只挑出「尚未繳交 108 學年度腳踏車證費用的學生列表」的需求來講解，其餘的需求則先帶過：</p>
<figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 1. 新增一個類別（插件）並實作 ConditionPlugin 介面：</span></span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> *「學生列表」插件：撈取指定學年度與符合付款狀態的學生</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentListPluginThatNotPaidBicyclePassFee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ConditionPlugin</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> $bicyclePassYear;</span><br><span class="line">    <span class="hljs-keyword">private</span> $payStatus;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($bicyclePassYear, $payStatus)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;bicyclePassYear = $bicyclePassYear;</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;payStatus = $payStatus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 2. 將原本放在 `StudentModel-&gt;studentList()` 的邏輯搬移至此</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setWhereCondition</span><span class="hljs-params">($db)</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        $db-&gt;leftJoin(<span class="hljs-string">'bicyclePass'</span>, <span class="hljs-string">'students.id = bicyclePass.studentId'</span>);</span><br><span class="line">        $db-&gt;where(<span class="hljs-string">'bicyclePass.year'</span>, <span class="hljs-keyword">$this</span>-&gt;bicyclePassYear);</span><br><span class="line">        $db-&gt;where(<span class="hljs-string">'bicyclePass.payStatus'</span>, <span class="hljs-keyword">$this</span>-&gt;payStatus);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 3. 修改 StudentController，從 Controller 配置 StudentModel 的擴充插件</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span></span><br><span class="line"><span class="hljs-class"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">/** var \StudentModel **/</span></span><br><span class="line">    <span class="hljs-keyword">private</span> $model;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/** 顯示某班級的所有學生 **/</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">studentList</span><span class="hljs-params">($classId)</span> </span>&#123; <span class="hljs-comment">/** ...省略 */</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/** 已完成作業的學生列表 **/</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">studentListByHomeworkStatus</span><span class="hljs-params">()</span></span>&#123; <span class="hljs-comment">/** ...省略 */</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/** 尚未繳交 108 學年度腳踏車證費用的學生列表 **/</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">studentListThatNotPaidBicyclePassFee</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        $classId = <span class="hljs-keyword">$this</span>-&gt;input-&gt;get(<span class="hljs-string">'classId'</span>);</span><br><span class="line">        $bicyclePassYear = <span class="hljs-number">108</span>;</span><br><span class="line">        $payStatus = <span class="hljs-keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        $ConditionPlugin = <span class="hljs-keyword">new</span> StudentListPluginThatNotPaidBicyclePassFee($bicyclePassYear, $payStatus);</span><br><span class="line">        <span class="hljs-keyword">$this</span>-&gt;model-&gt;setConditionPlugin($ConditionPlugin);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;model-&gt;studentList($classId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>這個步驟中，我們建立了一個名稱為 <code>StudentListPluginThatNotPaidBicyclePassFee</code> 的插件，這個插件裡面的邏輯，其實就是把原本寫在 <code>StudentModel-&gt;studentList()</code> 的邏輯搬移過來而已。其他的「學生列表」功能也要以此類推，把當初寫在 <code>StudentModel-&gt;studentList()</code> 的邏輯搬移到自己的插件中。這麼一來，就已經把核心邏輯與附加邏輯拆開了。</p>
<p>最後在每個需求的 Controller 層，透過 <strong>StudentModel</strong> 的公開方法<code>setConditionPlugin()</code> 將插件注入 <strong>StudentModel</strong> 裡面。<strong>StudentModel</strong> 在撈取學生時就可以透過被注入的插件來擴充核心邏輯。</p>
<h1 id="3-每個插件都只負責一個職責"><a href="#3-每個插件都只負責一個職責" class="headerlink" title="3. 每個插件都只負責一個職責"></a>3. 每個插件都只負責一個職責</h1><p>上一步驟中，將每個附加邏輯與核心邏輯隔離後，即可產生新的結構：</p>
<p><img src="/blog/images/pasted-6.png" alt="圖三：每個插件都只負責一個職責"></p>
<p><strong>（圖三）</strong>中，<strong>每個插件都只負責執行一個需求的程式碼</strong>；<code>StudentModel-&gt;studentList()</code> 函式則專注於撈取學生列表。兜了這麼大一圈，這才是 <strong>單一職責原則</strong> 要我們做的事情：</p>
<ol>
<li>隔離 <strong>核心邏輯</strong> 與 <strong>附加功能邏輯</strong></li>
<li>當使用 <strong>核心邏輯</strong> 的情境不同時，就應該隔離該使用情境的程式碼</li>
<li>每個類別最多只負責一個情境的程式碼，避免造成耦合，或意圖模糊</li>
</ol>
<p>單一職責原則，其實是以更高一層的角度在看程式碼。寫程式碼的時候，應該時時刻刻注意當前的程式碼會不會跟 <strong>當前需求</strong> 不相關的程式碼寫在一起。若有的話表示 <strong>核心邏輯</strong> 和 <strong>附加功能邏輯</strong> 可能已經混在一起了，這時就可以考慮導入單一職責原則，隔離 <strong>核心邏輯</strong> 和 <strong>附加邏輯</strong>，並且確保每個類別只負責一個需求的程式碼，避免程式碼的耦合越來越深。</p>
<h1 id="所以單一職責的職責到底是什麼？"><a href="#所以單一職責的職責到底是什麼？" class="headerlink" title="所以單一職責的職責到底是什麼？"></a>所以單一職責的職責到底是什麼？</h1><p>很多人被單一職責原則的名字給混淆了，以為一個類別只可以做一件事情。但事實上「一次只做一件事」是函式層級的原則。</p>
<p><strong>單一職責原則在類別層級中，用來劃分介面和型別的邊界<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>，將不同意圖、不同使用情境、不同需求、不同修改時機的功能劃分為各自獨立的「職責」，最後由類別來實現這些被獨立的職責</strong>。因此當一個職責的需求異動時，也表示只有 <strong>負責實現該職責的類別</strong> 需要被異動（修改局部化）。</p>
<p>為了讓類別容易被維護，一個類別應該盡可能減少負責的職責，這就是單一職責原則想傳達的概念：</p>
<blockquote>
<p>「A class should have only one reason to change.」<br>以一個類別來說，應該只有一個引起它變化的原因。</p>
</blockquote>
<p>「only one reason to change」，其實就是在說一個類別應該只負責 <strong>一個意圖</strong> 或 <strong>一個使用情境</strong>，也就是上述的「<strong>職責</strong>」。</p>
<p>這意味著<strong>系統功能會由許多小巧且高內聚的類別組成</strong>，且每個類別只專注於實現單一的職責。</p>
<p>單一職責做得很好時，每個類別都只有一個唯一的目的。因此需要進行功能修改的時候可以更容易地專注在一個或特定幾個類別。不但加快找查程式碼的速度，也讓系統的修改可以局部化，降低維護系統的困難度。<br>因此在一個高內聚性的系統中，程式碼可讀性及復用的可能性都會提高，儘管程式複雜，但容易被管理。</p>
<h2 id="系列文章："><a href="#系列文章：" class="headerlink" title="系列文章："></a>系列文章：</h2><ol>
<li><a href="/blog/why_SOLID_principles_matter_to_you/">淺談物件導向 SOLID 原則對工程師的好處與如何影響能力</a></li>
<li><a href="/blog/why_we_need_SOLID_principles/">再談 SOLID 原則，Why SOLID?</a></li>
<li><a href="/blog/solid_srp_definition_and_practices/">物件導向設計原則：單一職責原則，定義、解析與實踐</a></li>
<li><a href="https://wadehuang1993.github.io/blog/solid_ocp_definition_and_practices/">物件導向設計原則：開放封閉原則，定義、解析與實踐</a></li>
<li><a href="/blog/solid_lsp_definition_and_practices/">物件導向設計原則：裡氏替換原則，定義、解析</a></li>
</ol>
<h3 id="註腳1-耦合：將許多功能封裝在同一個類別、介面、方法，但這些功能彼此的意圖卻不相同。-↩2-邊界：明確定義一個類別、函式要實作的功能目標與涉及範圍。-↩"><a href="#註腳1-耦合：將許多功能封裝在同一個類別、介面、方法，但這些功能彼此的意圖卻不相同。-↩2-邊界：明確定義一個類別、函式要實作的功能目標與涉及範圍。-↩" class="headerlink" title="註腳1.耦合：將許多功能封裝在同一個類別、介面、方法，但這些功能彼此的意圖卻不相同。 ↩2.邊界：明確定義一個類別、函式要實作的功能目標與涉及範圍。 ↩"></a>註腳<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;">耦合：將許多功能封裝在同一個類別、介面、方法，但這些功能彼此的意圖卻不相同。</span><a href="#fnref:1" rev="footnote"> ↩</a></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">2.</span><span style="display: inline-block; vertical-align: top;">邊界：明確定義一個類別、函式要實作的功能目標與涉及範圍。</span><a href="#fnref:2" rev="footnote"> ↩</a></li></ol></div></div></h3>
        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/blog/tags/Clean-Code/" rel="tag">Clean Code</a>, <a class="has-link-grey -link" href="/blog/tags/SOLID-%E5%8E%9F%E5%89%87/" rel="tag">SOLID 原則</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/blog/solid_ocp_definition_and_practices/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">物件導向設計原則：開放封閉原則，定義、解析與實踐</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/blog/cluelessness_in_self_learning/">
                <span class="level-item">自學時應該看破“無緒”</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>


</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left is-sticky">
    
        

    <div class="card widget" id="toc">
        <div class="card-content">
            <div class="menu">
                <h3 class="menu-label">
                    文章目錄
                </h3>
                <ul class="menu-list"><li>
        <a class="is-flex" href="#定義：">
        <span class="has-mr-6">1</span>
        <span>定義：</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#目的：">
        <span class="has-mr-6">1.1</span>
        <span>目的：</span>
        </a></li><li>
        <a class="is-flex" href="#解析：">
        <span class="has-mr-6">1.2</span>
        <span>解析：</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#什麼是內聚？">
        <span class="has-mr-6">1.2.1</span>
        <span>什麼是內聚？</span>
        </a></li><li>
        <a class="is-flex" href="#什麼情況會造成低內聚">
        <span class="has-mr-6">1.2.2</span>
        <span>什麼情況會造成低內聚?</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#單一職責原則對專案的重要性？">
        <span class="has-mr-6">1.3</span>
        <span>單一職責原則對專案的重要性？</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#為什麼意圖如此重要呢？">
        <span class="has-mr-6">1.3.1</span>
        <span>為什麼意圖如此重要呢？</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#隔離意圖也是解除耦合">
        <span class="has-mr-6">1.4</span>
        <span>隔離意圖也是解除耦合</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#實踐">
        <span class="has-mr-6">2</span>
        <span>實踐</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#如何隔離意圖？">
        <span class="has-mr-6">2.1</span>
        <span>如何隔離意圖？</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#隔離意圖前，須先學會找出可能發生「意圖糾纏」的地方">
        <span class="has-mr-6">2.1.1</span>
        <span>隔離意圖前，須先學會找出可能發生「意圖糾纏」的地方</span>
        </a></li><li>
        <a class="is-flex" href="#範例：學生列表">
        <span class="has-mr-6">2.1.2</span>
        <span>範例：學生列表</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#隔離意圖：功能插件化-的思維">
        <span class="has-mr-6">2.2</span>
        <span>隔離意圖：功能插件化 的思維</span>
        </a></li><li>
        <a class="is-flex" href="#導入介面（Interface）">
        <span class="has-mr-6">2.3</span>
        <span>導入介面（Interface）</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#1-找出核心邏輯，並開放擴充介面">
        <span class="has-mr-6">2.3.1</span>
        <span>1. 找出核心邏輯，並開放擴充介面</span>
        </a></li><li>
        <a class="is-flex" href="#2-實作插件介面，並於注入插件">
        <span class="has-mr-6">2.3.2</span>
        <span>2. 實作插件介面，並於注入插件</span>
        </a></li></ul></li></ul></li><li>
        <a class="is-flex" href="#3-每個插件都只負責一個職責">
        <span class="has-mr-6">3</span>
        <span>3. 每個插件都只負責一個職責</span>
        </a></li><li>
        <a class="is-flex" href="#所以單一職責的職責到底是什麼？">
        <span class="has-mr-6">4</span>
        <span>所以單一職責的職責到底是什麼？</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#系列文章：">
        <span class="has-mr-6">4.1</span>
        <span>系列文章：</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#註腳1-耦合：將許多功能封裝在同一個類別、介面、方法，但這些功能彼此的意圖卻不相同。-↩2-邊界：明確定義一個類別、函式要實作的功能目標與涉及範圍。-↩">
        <span class="has-mr-6">4.1.1</span>
        <span>註腳1.耦合：將許多功能封裝在同一個類別、介面、方法，但這些功能彼此的意圖卻不相同。 ↩2.邊界：明確定義一個類別、函式要實作的功能目標與涉及範圍。 ↩</span>
        </a></li></ul></li></ul></li></ul>
            </div>
        </div>
    </div>

    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/blog/unit_test_and_integrate_test_definition/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/blog/images/thumbnail/UNIT_TEST.png" alt="探討單元測試和整合測試的涵蓋範圍">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-01-14T15:11:00.000Z">2020-01-14</time></div>
                    <a href="/blog/unit_test_and_integrate_test_definition/" class="title has-link-black-ter is-size-6 has-text-weight-normal">探討單元測試和整合測試的涵蓋範圍</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/blog/categories/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E6%80%9D%E7%B6%AD/">程式設計思維</a> / <a class="has-link-grey -link" href="/blog/categories/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E6%80%9D%E7%B6%AD/%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6/">單元測試</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/blog/design_patterns_interface_and_type_is_important/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/blog/images/thumbnail/DESIGN_PATTERN.png" alt="設計模式起手式：介面（Interface）">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-01-10T17:31:00.000Z">2020-01-11</time></div>
                    <a href="/blog/design_patterns_interface_and_type_is_important/" class="title has-link-black-ter is-size-6 has-text-weight-normal">設計模式起手式：介面（Interface）</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/blog/categories/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E6%80%9D%E7%B6%AD/">程式設計思維</a> / <a class="has-link-grey -link" href="/blog/categories/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E6%80%9D%E7%B6%AD/%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%EF%BC%88Design-Patterns%EF%BC%89/">設計模式（Design Patterns）</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/blog/codeigniter_3_unit_test_installation/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/blog/images/thumbnail/PHPUnitCodeIgniter3.png" alt="PHP CodeIgniter 3 單元測試日常：建立 PHPUnit 測試環境">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-01-07T05:40:00.000Z">2020-01-07</time></div>
                    <a href="/blog/codeigniter_3_unit_test_installation/" class="title has-link-black-ter is-size-6 has-text-weight-normal">PHP CodeIgniter 3 單元測試日常：建立 PHPUnit 測試環境</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/blog/categories/CodeIgniter-3-%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6%E6%97%A5%E5%B8%B8/">CodeIgniter 3 單元測試日常</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/blog/solid_lsp_definition_and_practices/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/blog/images/thumbnail/CLEAN_CODE.jpg" alt="物件導向設計原則：里氏替換原則，定義、解析">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-31T20:08:36.000Z">2020-01-01</time></div>
                    <a href="/blog/solid_lsp_definition_and_practices/" class="title has-link-black-ter is-size-6 has-text-weight-normal">物件導向設計原則：里氏替換原則，定義、解析</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/blog/categories/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E6%80%9D%E7%B6%AD/">程式設計思維</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/blog/2019_review/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/blog/images/thumbnail/2019_reviews.png" alt="2019 回顧工作與學習歷程">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-19T06:48:16.000Z">2019-12-19</time></div>
                    <a href="/blog/2019_review/" class="title has-link-black-ter is-size-6 has-text-weight-normal">2019 回顧工作與學習歷程</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分類
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/blog/categories/CodeIgniter-3-%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6%E6%97%A5%E5%B8%B8/">
            <span class="level-start">
                <span class="level-item">CodeIgniter 3 單元測試日常</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/blog/categories/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E6%80%9D%E7%B6%AD/">
            <span class="level-start">
                <span class="level-item">程式設計思維</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">12</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/blog/categories/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E6%80%9D%E7%B6%AD/%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6/">
            <span class="level-start">
                <span class="level-item">單元測試</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/blog/categories/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E6%80%9D%E7%B6%AD/%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%EF%BC%88Design-Patterns%EF%BC%89/">
            <span class="level-start">
                <span class="level-item">設計模式（Design Patterns）</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/blog/categories/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E6%80%9D%E7%B6%AD/%E9%87%8D%E6%A7%8B/">
            <span class="level-start">
                <span class="level-item">重構</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                標籤
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/blog/tags/Clean-Code/">
                        <span class="tag">Clean Code</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/blog/tags/CodeIgniter3/">
                        <span class="tag">CodeIgniter3</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/blog/tags/PHP/">
                        <span class="tag">PHP</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/blog/tags/SOLID-%E5%8E%9F%E5%89%87/">
                        <span class="tag">SOLID 原則</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/blog/tags/%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6/">
                        <span class="tag">單元測試</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/blog/tags/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC/">
                        <span class="tag">測試驅動開發</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/blog/tags/%E8%87%AA%E5%AD%B8%E6%8A%80%E5%B7%A7/">
                        <span class="tag">自學技巧</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/blog/tags/%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F%EF%BC%88Design-Patterns%EF%BC%89/">
                        <span class="tag">設計模式（Design Patterns）</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/blog/tags/%E9%87%8D%E6%A7%8B/">
                        <span class="tag">重構</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/blog/">
                
                    <img src="/blog/images/mylogo.png" alt="物件導向設計原則：單一職責原則，定義、解析與實踐" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 WadeHuangTW1993&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-TW");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
<script src="/blog/js/animation.js"></script>

    
    
<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/blog/js/gallery.js" defer></script>

    
    
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" rel="noopener">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>

    
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>
    
    
<a id="back-to-top" title="回到頁首" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/blog/js/back-to-top.js" defer></script>

    
    
    
    
    
    
    
    
    
    
    


<script src="/blog/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="請輸入關鍵字..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '頁面',
                CATEGORIES: '分類',
                TAGS: '標籤',
                UNTITLED: '(無標題)',
            },
            CONTENT_URL: '/blog/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/blog/js/insight.js" defer></script>
<link rel="stylesheet" href="/blog/css/search.css">
<link rel="stylesheet" href="/blog/css/insight.css">
    

    <script src="/blog/js/hexo_resize_image.js"></script>
</body>
</html>